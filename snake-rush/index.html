<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="Snake Rush - A classic snake game with themes, sounds, and responsive design">
    <meta name="theme-color" content="#2a8a6a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Snake Rush">
    <title>Snake Rush</title>
    <link rel="icon" type="image/png" href="icons/icon-192.png">
    <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
    <link rel="manifest" href="manifest.json">
    <!-- External ES6 Module: Tippy.js CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tippy.js@6/dist/tippy.css">
    <link rel="stylesheet" href="css/themes.css?v=3">
    <link rel="stylesheet" href="css/style.css?v=21">
</head>
<body>
    <div class="app-container">
        <!-- Intro Splash Screen -->
        <div id="introSplash" class="intro-splash">
            <h1 class="intro-title">
                <span class="snake-emoji-large">üêç</span>
                Snake Rush
                <span class="snake-emoji-large">üêç</span>
            </h1>
        </div>

        <!-- Main Menu -->
        <div id="mainMenu" class="screen">
            <div class="menu-content-full">
                <div class="menu-title-snakes">
                    <span class="title-snake-top">üêç</span>
                    <h1 class="menu-title">Snake Rush</h1>
                    <span class="title-snake-bottom">üêç</span>
                </div>
                <div class="menu-logo">
                    <div class="snake-animation">
                        <span class="snake-emoji-large">üêç</span>
                    </div>
                </div>
                <div class="high-score-badge">
                    <span class="score-label">HIGH SCORE</span>
                    <span id="highScoreMenu" class="score-value-large">0</span>
                </div>
                <div class="player-info-badge">
                    <span class="player-label">Playing as:</span>
                    <span id="currentPlayerDisplay" class="player-name-display">Guest</span>
                    <button id="changePlayerBtn" class="btn-change-player">Change</button>
                </div>
                <div class="menu-buttons-full">
                    <button id="playBtn" class="btn btn-primary btn-large">
                        <span class="btn-icon">‚ñ∂</span>
                        PLAY
                    </button>
                    <button id="leaderboardBtn" class="btn btn-secondary btn-large">
                        <span class="btn-icon">üèÜ</span>
                        SCOREBOARD
                    </button>
                    <button id="howToPlayBtn" class="btn btn-secondary btn-large">
                        <span class="btn-icon">?</span>
                        HOW TO PLAY
                    </button>
                    <button id="settingsBtn" class="btn btn-secondary btn-large">
                        <span class="btn-icon">‚öô</span>
                        SETTINGS
                    </button>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="screen">
            <div class="game-header">
                <!-- Row 1: Score, Level/Target/Timer, Pause/Quit -->
                <div class="header-row-main">
                    <div class="score-display">
                        <span class="score-label">Score:</span>
                        <span id="currentScore" class="score-value">0</span>
                    </div>
                    <div class="level-display" id="levelDisplay">
                        <span class="score-label">Level:</span>
                        <span id="currentLevel" class="score-value">1</span>
                    </div>
                    <div class="target-display" id="targetDisplay">
                        <span class="score-label">Target:</span>
                        <span id="targetScore" class="score-value">100</span>
                    </div>
                    <div id="timerDisplay" class="timer-display hidden">
                        <div class="timer-icon">‚è∞</div>
                        <span id="currentTime" class="timer-value">60</span>
                        <div id="clockBonus" class="clock-bonus hidden">+15s</div>
                    </div>
                    <div class="header-buttons">
                        <button id="pauseBtn" class="btn-icon-only" aria-label="Pause">‚è∏</button>
                        <button id="quitBtnHeader" class="btn-icon-only" aria-label="Quit">‚úï</button>
                    </div>
                </div>
            </div>
            <div class="game-container">
                <canvas id="gameCanvas"></canvas>
            </div>
        </div>

        <!-- Pause Menu -->
        <div id="pauseMenu" class="modal-overlay">
            <div class="modal">
                <h2>Paused</h2>
                <div class="modal-buttons">
                    <button id="resumeBtn" class="btn btn-primary">Resume</button>
                    <button id="quitBtn" class="btn btn-secondary">Quit to Menu</button>
                </div>
            </div>
        </div>

        <!-- Level Complete Screen -->
        <div id="levelCompleteScreen" class="modal-overlay">
            <div class="modal">
                <h2>üéâ Level Complete!</h2>
                <div class="score-summary">
                    <p>Your Score: <span id="levelCompleteScore" class="score-value">0</span></p>
                    <p>Target Score: <span id="levelCompleteTarget" class="score-value">100</span></p>
                </div>
                <div class="modal-buttons">
                    <button id="nextLevelBtn" class="btn btn-primary">Next Level</button>
                    <button id="playAgainLevelBtn" class="btn btn-primary">Play Again</button>
                    <button id="quitLevelBtn" class="btn btn-secondary">Quit to Menu</button>
                </div>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div id="gameOverScreen" class="modal-overlay">
            <div class="modal">
                <h2 id="gameOverTitle">Game Over!</h2>
                <div class="score-summary">
                    <p>Your Score: <span id="finalScore" class="score-value">0</span></p>
                    <p>High Score: <span id="bestScore" class="score-value">0</span></p>
                    <p id="levelTarget" class="hidden">Target Score: <span class="score-value">100</span></p>
                    <p id="levelCompletedDisplay" class="level-complete hidden">‚úÖ Level Complete!</p>
                    <p id="newHighScore" class="new-high-score hidden">üéâ New High Score! üéâ</p>
                    <p id="bonusPoints" class="bonus-points hidden">Bonus Points: <span class="score-value">+0</span></p>
                </div>
                <div class="modal-buttons">
                    <button id="playAgainBtn" class="btn btn-primary">Play Again</button>
                    <button id="nextLevelGameOverBtn" class="btn btn-primary hidden">Next Level</button>
                    <button id="menuBtn" class="btn btn-secondary">Main Menu</button>
                </div>
            </div>
        </div>

        <!-- Level Select Modal -->
        <div id="levelSelectModal" class="modal-overlay">
            <div class="modal level-select-modal">
                <h2>Select Level</h2>
                <div class="levels-grid" id="levelsGrid">
                    <!-- Levels will be generated by JS -->
                </div>
                <button id="closeLevelSelect" class="btn btn-secondary">Back</button>
            </div>
        </div>

        <!-- How to Play Modal -->
        <div id="howToPlayModal" class="modal-overlay">
            <div class="modal">
                <h2>How to Play</h2>
                <div class="instructions">
                    <section>
                        <h3>üéØ Objective</h3>
                        <p>Guide your snake to eat fruits and grow longer. Avoid hitting the walls, yourself, or obstacles!</p>
                    </section>
                    <section>
                        <h3>üéÆ Controls</h3>
                        <div class="controls-list">
                            <div class="control-item">
                                <span class="control-icon">‚å®Ô∏è</span>
                                <span><strong>Desktop:</strong> Arrow keys or WASD</span>
                            </div>
                            <div class="control-item">
                                <span class="control-icon">üëÜ</span>
                                <span><strong>Mobile:</strong> Swipe in any direction</span>
                            </div>
                            <div class="control-item">
                                <span class="control-icon">‚è∏</span>
                                <span><strong>Pause:</strong> Press Space or tap pause button</span>
                            </div>
                        </div>
                    </section>
                    <section>
                        <h3>‚≠ê Bonus Points</h3>
                        <p>Eat fruits quickly to earn bonus points! Watch for the golden fruit üåü that appears randomly for +50 points!</p>
                    </section>
                    <section>
                        <h3>üéÆ Game Modes</h3>
                        <div class="mode-item">
                            <h4>‚ôæÔ∏è Endless Mode</h4>
                            <p>Play without limits! Keep growing your snake and beat your high score. No levels, no targets‚Äîjust endless snake action!</p>
                        </div>
                        <div class="mode-item">
                            <h4>üéØ Levels Mode</h4>
                            <p>Complete levels by reaching the target score. Each level has unique obstacles and challenges. Higher levels have more obstacles!</p>
                        </div>
                        <div class="mode-item">
                            <h4>‚è±Ô∏è Time Mode</h4>
                            <p>Race against the clock! You have 60 seconds to score as many points as possible. Different fruits give different points - rarer fruits are worth more! Avoid tamarind at all costs as they deduct 60 points. Look out for clock power-ups that add +15 seconds to your timer. Plan your route carefully to maximize your score before time runs out!</p>
                            <ul class="fruit-points-list">
                                <li>üçì Strawberry: <strong class="legend-value">50 points</strong></li>
                                <li>üçí Cherry: <strong class="legend-value">40 points</strong></li>
                                <li>üçé Apple: <strong class="legend-value">30 points</strong></li>
                                <li>üçá Grape: <strong class="legend-value">20 points</strong></li>
                                <li>üçä Orange: <strong class="legend-value">10 points</strong></li>
                                <li>ü•ú Tamarind: <strong class="legend-value legend-danger">-60 points</strong></li>
                            </ul>
                        </div>
                    </section>
                </div>
                <button id="closeHowToPlay" class="btn btn-primary">Got it!</button>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settingsModal" class="modal-overlay">
            <div class="modal settings-modal">
                <h2>Settings</h2>
                <div class="settings-content">
                    <div class="setting-group">
                        <label for="modeSelect">
                            <span class="setting-label">Game Mode</span>
                            <span class="setting-icon">üéÆ</span>
                        </label>
                        <select id="modeSelect" class="setting-select">
                            <option value="endless">‚ôæÔ∏è Endless</option>
                            <option value="levels">üéÆ Levels</option>
                            <option value="time">‚è±Ô∏è Time Mode</option>
                        </select>
                    </div>
                    <div class="setting-group" id="settingGroupLevels">
                        <button id="levelsBtn" class="btn btn-secondary levels-settings-btn">
                            <span class="btn-icon">üéÆ</span>
                            Select Level
                        </button>
                    </div>
                    <div class="setting-group">
                        <label for="themeSelect">
                            <span class="setting-label">Theme</span>
                            <span class="setting-icon">üé®</span>
                        </label>
                        <select id="themeSelect" class="setting-select">
                            <option value="classic">Classic</option>
                            <option value="neon">Neon</option>
                            <option value="ocean">Ocean</option>
                            <option value="berry">Berry</option>
                            <option value="sunset">Sunset</option>
                            <option value="light">Light</option>
                            <option value="dark">Dark</option>
                        </select>
                    </div>
                    <div class="setting-group" id="settingGroupFruit">
                        <label for="fruitSelect">
                            <span class="setting-label">Fruit Type</span>
                            <span class="setting-icon" id="fruitTypeIcon">üçé</span>
                        </label>
                        <select id="fruitSelect" class="setting-select">
                            <option value="apple">Apple üçé</option>
                            <option value="cherry">Cherry üçí</option>
                            <option value="strawberry">Strawberry üçì</option>
                            <option value="orange">Orange üçä</option>
                            <option value="grape">Grape üçá</option>
                            <option value="random">Random üé≤</option>
                        </select>
                    </div>
                    <div class="setting-group">
                        <label for="difficultySelect">
                            <span class="setting-label">Difficulty</span>
                            <span class="setting-icon">‚ö°</span>
                        </label>
                        <select id="difficultySelect" class="setting-select">
                            <option value="easy" selected>Easy</option>
                            <option value="medium">Medium</option>
                            <option value="hard">Hard</option>
                        </select>
                    </div>
                    <div class="setting-group sound-section">
                        <h3 class="sound-title">üîä Sound Settings</h3>
                    </div>
                    <div class="setting-group">
                        <label class="setting-toggle">
                            <span class="setting-label">Master Sound</span>
                            <input type="checkbox" id="masterSoundToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-group">
                        <label class="setting-toggle">
                            <span class="setting-label">üéµ BGM</span>
                            <input type="checkbox" id="bgmSoundToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <button id="closeSettings" class="btn btn-primary">Save & Close</button>
            </div>
        </div>

        <!-- Player Name Prompt Modal -->
        <div id="playerNameModal" class="modal-overlay">
            <div class="modal">
                <h2>üéÆ Welcome!</h2>
                <div class="player-name-content">
                    <p>Enter your name to track your scores:</p>
                    <input type="text" id="playerNameInput" class="player-name-input" placeholder="Enter your name..." maxlength="15">
                    <div class="modal-buttons player-name-buttons">
                        <button id="savePlayerName" class="btn btn-primary">Play</button>
                        <button id="playAsGuest" class="btn btn-secondary">Play as Guest</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scoreboard Modal -->
        <div id="leaderboardModal" class="modal-overlay">
            <div class="modal leaderboard-modal">
                <h2>üèÜ Scoreboard</h2>
                <div class="leaderboard-content">
                    <div id="leaderboardList" class="leaderboard-list">
                        <!-- Leaderboard entries will be populated by JS -->
                        <div class="leaderboard-loading">Loading...</div>
                    </div>
                </div>
                <button id="closeLeaderboard" class="btn btn-primary">Close</button>
            </div>
        </div>
    </div>

    <!-- External ES6 Module: canvas-confetti -->
    <script type="module">
        import confetti from 'https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/+esm';
        // Make confetti available globally for the game
        window.confetti = confetti;
    </script>

    <!-- External ES6 Module: Tone.js Audio System -->
    <script type="module">
        import * as AudioSystem from './js/audio-module.js';
        // Make AudioSystem available globally for compatibility with existing code
        window.AudioSystem = AudioSystem;
        // Signal that audio module is ready
        window.audioModuleReady = true;
        window.dispatchEvent(new Event('audio-module-ready'));
    </script>

    <!-- External ES6 Module: Tippy.js -->
    <script type="module">
        import tippy from 'https://cdn.jsdelivr.net/npm/tippy.js@6/+esm';
        // Make tippy available globally
        window.tippy = tippy;

        // Initialize tooltips when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            // Menu buttons (touch: false disables on mobile)
            tippy('#playBtn', { content: 'Start a new game', placement: 'bottom', touch: false });
            tippy('#leaderboardBtn', { content: 'View high scores', placement: 'bottom', touch: false });
            tippy('#howToPlayBtn', { content: 'Learn how to play', placement: 'bottom', touch: false });
            tippy('#settingsBtn', { content: 'Game settings', placement: 'bottom', touch: false });

            // Game controls
            tippy('#pauseBtn', { content: 'Pause game', placement: 'bottom', touch: false });
            tippy('#quitBtnHeader', { content: 'Quit to menu', placement: 'bottom', touch: false });
        });
    </script>

    <script src="js/input.js?v=14"></script>
    <script src="js/renderer.js?v=30"></script>
    <script src="js/game.js?v=42"></script>
    <script src="js/ui.js?v=32"></script>
    <script type="module" src="js/leaderboard.js?v=1"></script>
</body>
</html>
